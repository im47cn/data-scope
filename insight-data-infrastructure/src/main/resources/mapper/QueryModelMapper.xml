<![CDATA[<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.insightdata.infrastructure.persistence.mapper.QueryModelMapper">

    <resultMap id="BaseResultMap" type="com.insightdata.infrastructure.persistence.entity.QueryModelEntity">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="description" column="description"/>
        <result property="dataSources" column="data_sources" typeHandler="org.apache.ibatis.type.StringTypeHandler"/>
        <result property="tables" column="tables" typeHandler="org.apache.ibatis.type.StringTypeHandler"/>
        <result property="fields" column="fields" typeHandler="org.apache.ibatis.type.StringTypeHandler"/>
        <result property="joins" column="joins" typeHandler="org.apache.ibatis.type.StringTypeHandler"/>
        <result property="rootFilter" column="root_filter" typeHandler="org.apache.ibatis.type.StringTypeHandler"/>
        <result property="groupBy" column="group_by" typeHandler="org.apache.ibatis.type.StringTypeHandler"/>
        <result property="orderBy" column="order_by" typeHandler="org.apache.ibatis.type.StringTypeHandler"/>
        <result property="parameters" column="parameters" typeHandler="org.apache.ibatis.type.StringTypeHandler"/>
        <result property="options" column="options" typeHandler="org.apache.ibatis.type.StringTypeHandler"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="createdBy" column="created_by"/>
        <result property="updatedBy" column="updated_by"/>
        <result property="isPublic" column="is_public"/>
        <result property="tags" column="tags" typeHandler="org.apache.ibatis.type.StringTypeHandler"/>
        <result property="status" column="status" typeHandler="org.apache.ibatis.type.StringTypeHandler"/>
    </resultMap>

    <insert id="insert" parameterType="com.insightdata.infrastructure.persistence.entity.QueryModelEntity">
        INSERT INTO query_models (id, name, description, data_sources, tables, fields, joins, root_filter,
        group_by, order_by, parameters, options, created_at, updated_at, created_by, updated_by, is_public, tags, status)
        VALUES (#{id}, #{name}, #{description}, #{dataSources,jdbcType=VARCHAR}, #{tables,jdbcType=VARCHAR},
        #{fields,jdbcType=VARCHAR}, #{joins,jdbcType=VARCHAR}, #{rootFilter,jdbcType=VARCHAR},
        #{groupBy,jdbcType=VARCHAR}, #{orderBy,jdbcType=VARCHAR}, #{parameters,jdbcType=VARCHAR},
        #{options,jdbcType=VARCHAR}, #{createdAt}, #{updatedAt}, #{createdBy}, #{updatedBy}, #{isPublic},
        #{tags,jdbcType=VARCHAR}, #{status,jdbcType=VARCHAR})
    </insert>

    <select id="findById" resultMap="BaseResultMap">
        SELECT * FROM query_models WHERE id = #{id}
    </select>

    <select id="findAll" resultMap="BaseResultMap">
        SELECT * FROM query_models
    </select>

    <update id="update" parameterType="com.insightdata.infrastructure.persistence.entity.QueryModelEntity">
        UPDATE query_models
        SET name = #{name},
        description = #{description},
        data_sources = #{dataSources,jdbcType=VARCHAR},
        tables = #{tables,jdbcType=VARCHAR},
        fields = #{fields,jdbcType=VARCHAR},
        joins = #{joins,jdbcType=VARCHAR},
        root_filter = #{rootFilter,jdbcType=VARCHAR},
        group_by = #{groupBy,jdbcType=VARCHAR},
        order_by = #{orderBy,jdbcType=VARCHAR},
        parameters = #{parameters,jdbcType=VARCHAR},
        options = #{options,jdbcType=VARCHAR},
        updated_at = #{updatedAt},
        updated_by = #{updatedBy},
        is_public = #{isPublic,jdbcType=BOOLEAN},
        tags = #{tags,jdbcType=VARCHAR},
        status = #{status,jdbcType=VARCHAR}
        WHERE id = #{id}
    </update>

    <delete id="deleteById">
        DELETE FROM query_models WHERE id = #{id}
    </delete>

    <select id="findByNameContaining" resultMap="BaseResultMap">
        SELECT * FROM query_models WHERE name LIKE #{name}
    </select>

    <select id="existsByName" resultType="boolean">
        SELECT COUNT(*) > 0 FROM query_models WHERE name = #{name}
    </select>

</mapper>