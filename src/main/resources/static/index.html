<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InsightData - 数据管理与查询系统</title>
    
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ant-design-vue@1.7.8/dist/antd.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
    
    <!-- 引入脚本 -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue-router@3.5.3/dist/vue-router.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.24.0/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ant-design-vue@1.7.8/dist/antd.min.js"></script>
</head>
<body>
    <div id="app"></div>
    
    <!-- 数据源管理组件 -->
    <script src="/static/js/datasource/datasource-list.js"></script>
    <script src="/static/js/datasource/datasource-form.js"></script>
    <script src="/static/js/datasource/datasource-detail.js"></script>
    
    <!-- 表关系管理组件 -->
    <script src="/static/js/table-relationship/table-relationship-list.js"></script>
    <script src="/static/js/table-relationship/table-relationship-graph.js"></script>
    <script src="/static/js/table-relationship/table-relationship-page.js"></script>
    <script src="/static/js/table-relationship/index.js"></script>
    
    <!-- 仪表盘组件 -->
    <script>
        // 仪表盘组件
        Vue.component('dashboard', {
            data() {
                return {
                    loading: false,
                    stats: {
                        totalDataSources: 0,
                        activeDataSources: 0,
                        totalTables: 0,
                        totalQueries: 0
                    },
                    recentDataSources: [],
                    recentQueries: []
                };
            },
            mounted() {
                this.fetchStats();
                this.fetchRecentDataSources();
                this.fetchRecentQueries();
            },
            methods: {
                fetchStats() {
                    // 这里应该从后端获取统计数据
                    // 目前使用模拟数据
                    this.stats = {
                        totalDataSources: 5,
                        activeDataSources: 3,
                        totalTables: 120,
                        totalQueries: 45
                    };
                },
                fetchRecentDataSources() {
                    // 这里应该从后端获取最近的数据源
                    // 目前使用模拟数据
                    this.recentDataSources = [
                        { id: 1, name: '生产数据库', type: 'MYSQL', host: 'prod-db.example.com', active: true },
                        { id: 2, name: '测试数据库', type: 'POSTGRESQL', host: 'test-db.example.com', active: true },
                        { id: 3, name: '开发数据库', type: 'MYSQL', host: 'dev-db.example.com', active: false }
                    ];
                },
                fetchRecentQueries() {
                    // 这里应该从后端获取最近的查询
                    // 目前使用模拟数据
                    this.recentQueries = [
                        { id: 1, name: '月度销售报表', dataSource: '生产数据库', createdAt: '2025-03-14 10:30:00' },
                        { id: 2, name: '用户活跃度分析', dataSource: '生产数据库', createdAt: '2025-03-13 15:45:00' },
                        { id: 3, name: '产品库存统计', dataSource: '测试数据库', createdAt: '2025-03-12 09:15:00' }
                    ];
                },
                viewDataSource(id) {
                    this.$router.push(`/datasource/${id}`);
                },
                viewQuery(id) {
                    this.$router.push(`/query-builder?id=${id}`);
                },
                formatDate(date) {
                    return moment(date).format('YYYY-MM-DD HH:mm:ss');
                }
            },
            template: `
                <div class="dashboard-container">
                    <div class="page-header">
                        <h1>仪表盘</h1>
                    </div>
                    
                    <a-row :gutter="16">
                        <a-col :span="6">
                            <a-card>
                                <a-statistic
                                    title="数据源总数"
                                    :value="stats.totalDataSources"
                                    :valueStyle="{ color: '#3f8600' }"
                                >
                                    <template #prefix>
                                        <a-icon type="database" />
                                    </template>
                                </a-statistic>
                            </a-card>
                        </a-col>
                        <a-col :span="6">
                            <a-card>
                                <a-statistic
                                    title="活跃数据源"
                                    :value="stats.activeDataSources"
                                    :valueStyle="{ color: '#1890ff' }"
                                >
                                    <template #prefix>
                                        <a-icon type="check-circle" />
                                    </template>
                                </a-statistic>
                            </a-card>
                        </a-col>
                        <a-col :span="6">
                            <a-card>
                                <a-statistic
                                    title="表总数"
                                    :value="stats.totalTables"
                                    :valueStyle="{ color: '#722ed1' }"
                                >
                                    <template #prefix>
                                        <a-icon type="table" />
                                    </template>
                                </a-statistic>
                            </a-card>
                        </a-col>
                        <a-col :span="6">
                            <a-card>
                                <a-statistic
                                    title="查询总数"
                                    :value="stats.totalQueries"
                                    :valueStyle="{ color: '#fa8c16' }"
                                >
                                    <template #prefix>
                                        <a-icon type="search" />
                                    </template>
                                </a-statistic>
                            </a-card>
                        </a-col>
                    </a-row>
                    
                    <a-row :gutter="16" style="margin-top: 16px">
                        <a-col :span="12">
                            <a-card title="最近数据源" :bordered="false">
                                <a-list
                                    size="small"
                                    :dataSource="recentDataSources"
                                    :rowKey="item => item.id"
                                >
                                    <a-list-item slot="renderItem" slot-scope="item">
                                        <a-list-item-meta
                                            :title="item.name"
                                            :description="\`\${item.type} | \${item.host}\`"
                                        >
                                            <a-avatar
                                                slot="avatar"
                                                :style="{ backgroundColor: item.active ? '#52c41a' : '#f5222d' }"
                                                icon="database"
                                            />
                                        </a-list-item-meta>
                                        <a-button
                                            type="link"
                                            @click="viewDataSource(item.id)"
                                        >
                                            查看
                                        </a-button>
                                    </a-list-item>
                                    <div slot="footer" class="list-footer">
                                        <a-button
                                            type="primary"
                                            size="small"
                                            @click="$router.push('/datasource/list')"
                                        >
                                            查看全部
                                        </a-button>
                                    </div>
                                </a-list>
                            </a-card>
                        </a-col>
                        <a-col :span="12">
                            <a-card title="最近查询" :bordered="false">
                                <a-list
                                    size="small"
                                    :dataSource="recentQueries"
                                    :rowKey="item => item.id"
                                >
                                    <a-list-item slot="renderItem" slot-scope="item">
                                        <a-list-item-meta
                                            :title="item.name"
                                            :description="\`\${item.dataSource} | \${formatDate(item.createdAt)}\`"
                                        >
                                            <a-avatar
                                                slot="avatar"
                                                style="backgroundColor: #1890ff"
                                                icon="search"
                                            />
                                        </a-list-item-meta>
                                        <a-button
                                            type="link"
                                            @click="viewQuery(item.id)"
                                        >
                                            查看
                                        </a-button>
                                    </a-list-item>
                                    <div slot="footer" class="list-footer">
                                        <a-button
                                            type="primary"
                                            size="small"
                                            @click="$router.push('/query-builder')"
                                        >
                                            查看全部
                                        </a-button>
                                    </div>
                                </a-list>
                            </a-card>
                        </a-col>
                    </a-row>
                </div>
            `
        });
        
        // 查询构建器组件
        Vue.component('query-builder', {
            props: {
                dataSourceId: {
                    type: [Number, String],
                    default: null
                },
                schema: {
                    type: String,
                    default: null
                },
                table: {
                    type: String,
                    default: null
                }
            },
            template: `
                <div class="query-builder-container">
                    <div class="page-header">
                        <h1>查询构建器</h1>
                    </div>
                    <a-alert
                        message="功能开发中"
                        description="查询构建器功能正在开发中，敬请期待！"
                        type="info"
                        showIcon
                    />
                </div>
            `
        });
        
        // 自然语言查询组件
        Vue.component('nl-query', {
            template: `
                <div class="nl-query-container">
                    <div class="page-header">
                        <h1>自然语言查询</h1>
                    </div>
                    <a-alert
                        message="功能开发中"
                        description="自然语言查询功能正在开发中，敬请期待！"
                        type="info"
                        showIcon
                    />
                </div>
            `
        });
        
        // 低代码集成组件
        Vue.component('low-code', {
            template: `
                <div class="low-code-container">
                    <div class="page-header">
                        <h1>低代码集成</h1>
                    </div>
                    <a-alert
                        message="功能开发中"
                        description="低代码集成功能正在开发中，敬请期待！"
                        type="info"
                        showIcon
                    />
                </div>
            `
        });
        
        // 系统设置组件
        Vue.component('settings', {
            template: `
                <div class="settings-container">
                    <div class="page-header">
                        <h1>系统设置</h1>
                    </div>
                    <a-alert
                        message="功能开发中"
                        description="系统设置功能正在开发中，敬请期待！"
                        type="info"
                        showIcon
                    />
                </div>
            `
        });
    </script>
    
    <!-- 路由和应用程序 -->
    <script src="/static/js/router.js"></script>
    <script src="/static/js/app.js"></script>
</body>
</html>
