# 数据源管理页面前后端联调实施计划

## 概述

本文档描述了数据源管理页面前后端联调的详细实施计划。目前前端已有完整的UI组件和模拟数据服务，后端有部分API已实现，部分API尚待开发。本计划采用混合渐进式实施策略，分阶段完成联调工作。

## 系统架构

### 前端架构

- **框架**：Vue.js 2.7.14
- **UI库**：使用原生HTML和Tailwind CSS
- **主要组件**：
  - `datasource-list.js`：数据源列表组件
  - `datasource-form.js`：数据源表单组件
  - `datasource-detail.js`：数据源详情组件
  - `datasource-service.js`：数据源服务（API调用）

### 后端架构

- **框架**：Spring Boot
- **架构模式**：DDD四层架构
- **主要控制器**：
  - `DataSourceController`：数据源CRUD操作
  - `MetadataSyncJobController`：元数据同步操作

## 实施计划

### 阶段1：基础联调（1-2天）

**目标**：实现基本CRUD功能的前后端联调

**任务**：

1. **修改前端DataSourceService**
   - 替换模拟API为真实后端REST API调用
   - 调整数据格式以匹配后端DTO
   - 添加适当的错误处理

2. **调整数据源列表组件**
   - 确保字段匹配后端返回的数据结构
   - 添加加载状态和错误处理
   - 测试分页、排序和筛选功能

3. **调整数据源表单组件**
   - 确保表单字段与后端DTO匹配
   - 实现数据验证
   - 测试创建和更新操作

4. **实现测试连接功能**
   - 调用测试连接API
   - 显示连接测试结果

### 阶段2：核心功能扩展（2-3天）

**目标**：实现元数据相关功能的联调

**任务**：

1. **后端实现**
   - 完成`getSchemas`API实现（DataSourceController）
   - 完成`getTables`API实现（DataSourceController）
   - 完成`syncMetadata`API实现（DataSourceController）

2. **前端适配**
   - 更新前端服务以调用新API
   - 实现元数据同步功能
   - 显示同步状态和进度

3. **测试和优化**
   - 测试元数据同步功能
   - 优化API调用以提高性能
   - 实现错误恢复机制

### 阶段3：高级功能和优化（2-3天）

**目标**：实现高级功能并优化性能

**任务**：

1. **实现表结构详情和数据预览**
   - 后端实现表结构详情API
   - 前端开发表结构展示组件
   - 实现简单数据预览功能

2. **性能优化**
   - 实现前端数据缓存
   - 优化大数据量渲染
   - 确保满足2万条数据TP99<100ms的性能要求

3. **用户体验优化**
   - 改进错误提示
   - 添加操作确认和提示
   - 优化加载状态显示

4. **全面测试**
   - 功能测试：确保所有功能正常工作
   - 性能测试：验证系统满足性能要求
   - 兼容性测试：测试不同浏览器和设备

## API接口规范

### 已实现API

1. **获取数据源列表**
   - 路径: `/api/datasources`
   - 方法: GET
   - 参数: 
     - type (可选): 数据源类型
     - active (可选): 是否活跃
     - page: 页码
     - size: 每页大小
     - sort: 排序字段和方向
   - 返回: 数据源列表分页结果

2. **获取数据源详情**
   - 路径: `/api/datasources/{id}`
   - 方法: GET
   - 参数: id (路径变量)
   - 返回: 数据源详细信息

3. **创建数据源**
   - 路径: `/api/datasources`
   - 方法: POST
   - 参数: DataSourceDTO (请求体)
   - 返回: 创建的数据源

4. **更新数据源**
   - 路径: `/api/datasources/{id}`
   - 方法: PUT
   - 参数: 
     - id (路径变量)
     - DataSourceDTO (请求体)
   - 返回: 更新后的数据源

5. **删除数据源**
   - 路径: `/api/datasources/{id}`
   - 方法: DELETE
   - 参数: id (路径变量)
   - 返回: 无内容 (204)

6. **测试连接**
   - 路径: `/api/datasources/{id}/test-connection`
   - 方法: POST
   - 参数: id (路径变量)
   - 返回: 连接测试结果

7. **获取支持的数据源类型**
   - 路径: `/api/datasources/types`
   - 方法: GET
   - 返回: 支持的数据源类型列表

### 待实现API

1. **获取Schema列表**
   - 路径: `/api/datasources/{id}/schemas`
   - 方法: GET
   - 参数: id (路径变量)
   - 返回: Schema列表

2. **获取表列表**
   - 路径: `/api/datasources/{id}/schemas/{schemaName}/tables`
   - 方法: GET
   - 参数: 
     - id (路径变量)
     - schemaName (路径变量)
   - 返回: 表列表

3. **同步元数据**
   - 路径: `/api/datasources/{id}/sync`
   - 方法: POST
   - 参数: id (路径变量)
   - 返回: 同步任务信息

## 数据结构映射

### 前端到后端映射

前端模拟数据中的字段与后端DTO字段的映射关系：

| 前端字段 | 后端字段 | 说明 |
|----------|----------|------|
| id | id | 数据源ID |
| name | name | 数据源名称 |
| type | type | 数据源类型 |
| host | host | 数据库主机 |
| port | port | 数据库端口 |
| databaseName | databaseName | 数据库名称 |
| username | username | 用户名 |
| password | password | 密码 |
| active | enabled | 是否启用 |
| description | description | 描述信息 |
| lastSyncedAt | lastSyncTime | 最后同步时间 |
| createdAt | createdAt | 创建时间 |
| updatedAt | updatedAt | 更新时间 |
| tags | tags | 标签 |

### 特殊处理字段

1. **密码字段**：
   - 创建/更新时从前端发送到后端
   - 查询时后端不返回给前端

2. **同步状态**：
   - 前端：复杂对象 `syncStatus`
   - 后端：通过查询同步任务获取

## 实施关键点

1. **安全性**：
   - 密码使用AES加密存储
   - 防止SQL注入
   - 验证和净化用户输入

2. **性能**：
   - 针对大数据量优化前端渲染
   - 实现适当的缓存策略
   - 确保满足TP99<100ms的性能要求

3. **用户体验**：
   - 提供清晰的错误信息
   - 添加加载状态指示
   - 实现友好的表单验证

4. **错误处理**：
   - 前端全局错误处理
   - 后端统一异常处理
   - 适当的错误日志记录

## 测试策略

1. **单元测试**：
   - 前端组件测试
   - 后端服务和控制器测试

2. **集成测试**：
   - API端点测试
   - 前后端交互测试

3. **性能测试**：
   - 大数据量测试（2万条）
   - 响应时间测试

4. **用户验收测试**：
   - 功能验收测试
   - 用户体验测试

## 风险和缓解措施

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| 前后端数据结构不匹配 | 中 | 高 | 仔细规划数据映射，实现适配层 |
| 元数据同步性能问题 | 高 | 中 | 实现异步处理，提供进度反馈 |
| 大数据量性能问题 | 中 | 高 | 实现虚拟滚动，分页加载 |
| 数据库连接安全问题 | 低 | 高 | 加密存储凭证，限制访问权限 |

## 里程碑和时间表

1. **里程碑1**：基础CRUD功能联调完成 - 第2天结束
2. **里程碑2**：元数据功能联调完成 - 第5天结束
3. **里程碑3**：高级功能和优化完成 - 第7天结束
4. **里程碑4**：全面测试和修复完成 - 第10天结束

## 团队职责

- **前端开发**：负责修改前端组件和服务
- **后端开发**：负责实现缺失API和优化现有实现
- **测试人员**：负责验证功能和性能
- **项目经理**：协调团队活动和监控进度

## 结论

本实施计划采用混合渐进式策略，确保能够按优先级逐步完成前后端联调工作。通过分阶段实施，可以降低风险，并在早期提供核心功能。