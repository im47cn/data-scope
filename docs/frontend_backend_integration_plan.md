# 前后端联调计划

## 1. 概述

本文档详细规划了DataScope系统前后端联调的实施方案，确保前端和后端能够无缝协作，快速实现系统功能。联调计划专注于数据源管理和查询构建器两个优先模块，提供了明确的接口约定、测试策略和协作流程。

## 2. 联调优先级

根据项目目标和资源限制，前后端联调将按以下优先级进行：

### 2.1 第一阶段：数据源管理模块联调（优先级：高）

1. 数据源CRUD操作接口
2. 数据源连接测试接口
3. 元数据提取和同步接口
4. 元数据浏览接口

### 2.2 第二阶段：查询构建器模块联调（优先级：高）

1. 数据源和元数据获取接口
2. SQL生成和验证接口
3. 查询执行和结果处理接口
4. 查询保存和加载接口

### 2.3 第三阶段：性能优化和高级功能（优先级：中）

1. 查询结果缓存机制
2. 大数据量查询处理
3. 表关系推断功能
4. 查询历史和统计功能

## 3. 前后端接口约定和规范

### 3.1 API路径规范

1. **基础路径**：`/api`
2. **版本控制**：`/api/v1`
3. **资源命名**：使用复数形式和连字符，如 `/api/v1/data-sources`
4. **子资源**：通过资源ID访问，如 `/api/v1/data-sources/{id}/schemas`
5. **操作**：通过HTTP方法表示，如 `GET`, `POST`, `PUT`, `DELETE`
6. **控制动作**：通过动词表示，如 `/api/v1/data-sources/{id}/test-connection`

### 3.2 请求规范

1. **内容类型**：`application/json`
2. **字符编码**：`UTF-8`
3. **日期时间格式**：ISO 8601 格式 (`YYYY-MM-DDThh:mm:ss.sssZ`)
4. **布尔值**：使用 `true` 和 `false`，不使用 `1` 和 `0`
5. **空值**：使用 `null`，不使用空字符串或 `undefined`
6. **分页参数**：
   - `page`: 页码（从0开始）
   - `size`: 每页大小
   - `sort`: 排序字段和方向（如 `name,asc`）

### 3.3 响应规范

1. **成功响应**：
   - `GET`: 状态码 200，返回资源
   - `POST`: 状态码 201，返回创建的资源
   - `PUT`: 状态码 200，返回更新后的资源
   - `DELETE`: 状态码 204，无响应体

2. **错误响应**：
   ```json
   {
     "status": 400,
     "code": "VALIDATION_ERROR",
     "message": "请求验证失败",
     "details": [
       {
         "field": "username",
         "error": "用户名不能为空"
       }
     ],
     "timestamp": "2025-03-15T12:34:56.789Z",
     "path": "/api/users"
   }
   ```

3. **分页响应**：
   ```json
   {
     "content": [
       {
         "id": "1",
         "name": "示例"
       }
     ],
     "pageable": {
       "page": 0,
       "size": 10,
       "sort": "name,asc",
       "totalElements": 100,
       "totalPages": 10
     }
   }
   ```

### 3.4 安全规范

1. **认证方式**：JWT Token，在请求头中通过 `Authorization: Bearer {token}` 提供
2. **授权控制**：基于角色的访问控制（RBAC）
3. **输入验证**：所有输入都必须经过验证，防止注入攻击
4. **敏感数据**：敏感数据在传输中加密，如密码不明文传输

## 4. 数据源管理模块前后端联调计划

### 4.1 数据源列表接口联调

#### 4.1.1 接口规范

- **路径**：`GET /api/v1/data-sources`
- **参数**：
  - `page`: 页码（默认0）
  - `size`: 每页大小（默认10）
  - `sort`: 排序字段和方向（如 `name,asc`）
  - `filter`: 筛选条件（JSON格式）
- **响应**：
  - 成功：状态码 200，返回数据源列表
  - 失败：状态码 4xx/5xx，返回错误信息

#### 4.1.2 联调步骤

1. **后端准备**：
   - 实现数据源列表接口
   - 准备测试数据
   - 实现分页、排序和筛选功能

2. **前端准备**：
   - 实现数据源列表组件
   - 实现分页、排序和筛选UI
   - 实现API调用逻辑

3. **联调测试**：
   - 测试基本列表加载
   - 测试分页功能
   - 测试排序功能
   - 测试筛选功能
   - 测试边界条件（空列表、大列表）
   - 测试错误处理

### 4.2 数据源创建接口联调

#### 4.2.1 接口规范

- **路径**：`POST /api/v1/data-sources`
- **请求体**：数据源创建请求
- **响应**：
  - 成功：状态码 201，返回创建的数据源
  - 失败：状态码 4xx/5xx，返回错误信息

#### 4.2.2 联调步骤

1. **后端准备**：
   - 实现数据源创建接口
   - 实现请求验证
   - 实现错误处理

2. **前端准备**：
   - 实现数据源创建表单
   - 实现表单验证
   - 实现API调用逻辑

3. **联调测试**：
   - 测试成功创建
   - 测试表单验证
   - 测试后端验证错误处理
   - 测试服务器错误处理
   - 测试唯一性约束（如重名）

### 4.3 数据源测试连接接口联调

#### 4.3.1 接口规范

- **路径**：`POST /api/v1/data-sources/test-connection`
- **请求体**：数据源连接参数
- **响应**：
  - 成功：状态码 200，返回连接测试结果
  - 失败：状态码 4xx/5xx，返回错误信息

#### 4.3.2 联调步骤

1. **后端准备**：
   - 实现测试连接接口
   - 实现各种数据库类型的连接测试
   - 实现错误处理和超时控制

2. **前端准备**：
   - 实现测试连接按钮
   - 实现加载状态显示
   - 实现结果展示

3. **联调测试**：
   - 测试成功连接
   - 测试连接失败（错误凭据）
   - 测试连接超时
   - 测试不可达服务器
   - 测试各种数据库类型

### 4.4 元数据同步接口联调

#### 4.4.1 接口规范

- **路径**：`POST /api/v1/data-sources/{id}/sync-metadata`
- **请求体**：同步选项
- **响应**：
  - 成功：状态码 200，返回同步任务ID
  - 失败：状态码 4xx/5xx，返回错误信息

#### 4.4.2 联调步骤

1. **后端准备**：
   - 实现元数据同步接口
   - 实现异步任务处理
   - 实现任务状态查询接口

2. **前端准备**：
   - 实现同步按钮
   - 实现任务进度显示
   - 实现定时查询任务状态

3. **联调测试**：
   - 测试成功同步
   - 测试同步失败
   - 测试同步进度更新
   - 测试取消同步
   - 测试大量数据同步
   - 测试任务恢复（如页面刷新）

## 5. 查询构建器模块前后端联调计划

### 5.1 SQL生成接口联调

#### 5.1.1 接口规范

- **路径**：`POST /api/v1/query/generate-sql`
- **请求体**：查询配置
- **响应**：
  - 成功：状态码 200，返回生成的SQL
  - 失败：状态码 4xx/5xx，返回错误信息

#### 5.1.2 联调步骤

1. **后端准备**：
   - 实现SQL生成接口
   - 实现查询配置验证
   - 实现不同数据库方言支持

2. **前端准备**：
   - 实现查询设计器组件
   - 实现查询配置状态管理
   - 实现SQL预览组件

3. **联调测试**：
   - 测试简单查询生成
   - 测试多表连接查询生成
   - 测试复杂条件生成
   - 测试分组和聚合生成
   - 测试排序和分页生成
   - 测试配置错误处理

### 5.2 查询执行接口联调

#### 5.2.1 接口规范

- **路径**：`POST /api/v1/query/execute`
- **请求体**：查询参数
- **响应**：
  - 成功：状态码 200，返回查询ID
  - 失败：状态码 4xx/5xx，返回错误信息

#### 5.2.2 联调步骤

1. **后端准备**：
   - 实现查询执行接口
   - 实现异步任务处理
   - 实现查询结果缓存
   - 实现超时控制

2. **前端准备**：
   - 实现查询执行按钮
   - 实现查询状态显示
   - 实现结果展示组件

3. **联调测试**：
   - 测试成功执行
   - 测试执行失败处理
   - 测试长时间查询
   - 测试大结果集处理
   - 测试并发查询
   - 测试取消查询

### 5.3 查询保存和加载接口联调

#### 5.3.1 接口规范

- **路径**：
  - 保存：`POST /api/v1/saved-queries`
  - 加载：`GET /api/v1/saved-queries/{id}`
- **请求体/响应**：查询配置
- **响应**：
  - 成功：状态码 200/201，返回查询配置
  - 失败：状态码 4xx/5xx，返回错误信息

#### 5.3.2 联调步骤

1. **后端准备**：
   - 实现查询保存接口
   - 实现查询加载接口
   - 实现查询列表接口

2. **前端准备**：
   - 实现保存查询表单
   - 实现加载查询对话框
   - 实现查询列表组件

3. **联调测试**：
   - 测试查询保存
   - 测试查询加载
   - 测试查询更新
   - 测试查询删除
   - 测试权限控制
   - 测试共享查询

## 6. 测试环境搭建和配置

### 6.1 开发环境配置

1. **后端服务**：
   - 本地运行SpringBoot应用
   - 配置H2内存数据库或本地MySQL
   - 配置开发环境属性（application-dev.yml）
   - 启用API文档（Swagger/OpenAPI）

2. **前端服务**：
   - 本地运行Vue开发服务器
   - 配置API代理，避免跨域问题
   - 配置热重载
   - 配置环境变量

3. **数据库**：
   - 配置测试数据库
   - 准备测试数据脚本
   - 自动初始化测试数据

4. **认证服务**：
   - 配置简化的认证机制
   - 提供测试用户账号
   - 配置开发环境跳过部分安全检查

### 6.2 联调环境配置

1. **服务器环境**：
   - 配置联调服务器
   - 部署后端服务
   - 部署前端静态资源

2. **网络配置**：
   - 配置反向代理
   - 配置CORS
   - 配置HTTPS（可选）

3. **日志配置**：
   - 配置详细日志
   - 配置日志聚合
   - 配置API请求日志

4. **监控配置**：
   - 配置接口监控
   - 配置性能监控
   - 配置错误监控

## 7. 联调测试策略

### 7.1 接口测试

1. **正向测试**：
   - 验证成功场景
   - 验证预期结果
   - 验证数据完整性

2. **异常测试**：
   - 验证输入验证
   - 验证错误处理
   - 验证异常恢复

3. **边界测试**：
   - 验证最小/最大值
   - 验证空值处理
   - 验证大数据量处理

4. **性能测试**：
   - 验证响应时间
   - 验证并发处理
   - 验证资源使用

### 7.2 端到端测试

1. **用户流程测试**：
   - 验证完整业务流程
   - 验证跨页面交互
   - 验证数据持久化

2. **交互测试**：
   - 验证UI响应
   - 验证状态转换
   - 验证反馈信息

3. **兼容性测试**：
   - 验证浏览器兼容性
   - 验证设备兼容性
   - 验证分辨率适配

### 7.3 自动化测试

1. **接口自动化测试**：
   - 使用Postman或JUnit编写接口测试
   - 配置测试数据
   - 设置断言验证

2. **前端自动化测试**：
   - 使用Jest编写单元测试
   - 使用Vue Test Utils测试组件
   - 使用Cypress编写端到端测试

3. **CI/CD集成**：
   - 配置自动化测试流水线
   - 配置代码质量检查
   - 配置自动部署

## 8. 问题跟踪和解决流程

### 8.1 问题分类

1. **接口问题**：
   - 接口规范不一致
   - 请求/响应格式错误
   - 接口逻辑错误

2. **前端问题**：
   - UI渲染问题
   - 状态管理问题
   - 前端逻辑问题

3. **后端问题**：
   - 业务逻辑错误
   - 数据处理错误
   - 性能问题

4. **环境问题**：
   - 配置错误
   - 网络问题
   - 依赖问题

### 8.2 问题跟踪工具

1. **JIRA**：
   - 记录所有问题
   - 分配责任人
   - 跟踪解决进度

2. **开发者工具**：
   - 浏览器开发者工具
   - API测试工具
   - 日志分析工具

### 8.3 问题解决流程

1. **问题报告**：
   - 描述问题现象
   - 提供复现步骤
   - 提供环境信息
   - 提供日志和截图

2. **问题分析**：
   - 确定问题类型
   - 定位问题来源
   - 分析根本原因

3. **问题解决**：
   - 制定解决方案
   - 实施修复
   - 验证解决结果

4. **经验总结**：
   - 记录解决方案
   - 更新文档
   - 分享经验教训

## 9. 实施时间表

| 阶段 | 任务 | 开始日期 | 结束日期 | 前端负责人 | 后端负责人 |
|------|------|----------|----------|-----------|-----------|
| 准备阶段 | 环境搭建和接口约定 | 2025-03-18 | 2025-03-19 | 前端开发 | 后端开发 |
| 第一阶段 | 数据源列表接口联调 | 2025-03-20 | 2025-03-21 | 前端开发 | 后端开发 |
| 第一阶段 | 数据源创建接口联调 | 2025-03-22 | 2025-03-23 | 前端开发 | 后端开发 |
| 第一阶段 | 数据源测试连接接口联调 | 2025-03-24 | 2025-03-25 | 前端开发 | 后端开发 |
| 第一阶段 | 元数据同步接口联调 | 2025-03-26 | 2025-03-28 | 前端开发 | 后端开发 |
| 第一阶段 | 元数据浏览接口联调 | 2025-03-29 | 2025-03-31 | 前端开发 | 后端开发 |
| 第一阶段 | 数据源管理集成测试 | 2025-04-01 | 2025-04-03 | 前端开发 | 后端开发 |
| 第二阶段 | SQL生成接口联调 | 2025-04-04 | 2025-04-06 | 前端开发 | 后端开发 |
| 第二阶段 | 查询执行接口联调 | 2025-04-07 | 2025-04-09 | 前端开发 | 后端开发 |
| 第二阶段 | 查询结果接口联调 | 2025-04-10 | 2025-04-12 | 前端开发 | 后端开发 |
| 第二阶段 | 查询保存和加载接口联调 | 2025-04-13 | 2025-04-15 | 前端开发 | 后端开发 |
| 第二阶段 | 查询构建器集成测试 | 2025-04-16 | 2025-04-19 | 前端开发 | 后端开发 |
| 优化阶段 | 性能优化和问题修复 | 2025-04-20 | 2025-04-26 | 前端开发 | 后端开发 |
| 验收阶段 | 系统测试和验收 | 2025-04-27 | 2025-05-01 | 前端开发 | 后端开发 |

## 10. 联调会议和沟通机制

### 10.1 定期会议

1. **每日站会**：
   - 时间：每工作日上午10:00
   - 内容：进度汇报、问题讨论、计划调整
   - 参与者：前后端开发人员

2. **联调专题会议**：
   - 时间：每周三下午14:00
   - 内容：联调进展、问题解决、接口调整
   - 参与者：前后端开发人员、项目经理

3. **阶段评审会议**：
   - 时间：每个阶段结束前
   - 内容：阶段成果验收、问题总结、下阶段计划
   - 参与者：前后端开发人员、项目经理、产品经理

### 10.2 沟通工具和渠道

1. **即时通讯**：
   - 企业微信：日常沟通
   - 专项群聊：联调专用群

2. **文档共享**：
   - Confluence：接口文档、会议记录
   - Git仓库：代码和配置文件

3. **问题跟踪**：
   - JIRA：问题记录和跟踪
   - 每日问题清单：重点问题跟踪

### 10.3 接口变更流程

1. **变更提议**：
   - 提出变更需求
   - 说明变更原因
   - 描述变更内容

2. **变更评审**：
   - 分析变更影响
   - 评估变更成本
   - 确定变更方案

3. **变更实施**：
   - 更新接口文档
   - 实施代码修改
   - 通知相关人员

4. **变更验证**：
   - 验证变更结果
   - 确认无副作用
   - 更新测试用例

## 11. 文档和资料共享

### 11.1 接口文档

1. **OpenAPI规范文档**：
   - 包含所有API端点定义
   - 包含请求和响应模式
   - 包含示例和说明

2. **接口变更日志**：
   - 记录所有接口变更
   - 注明变更日期和原因
   - 标记破坏性变更

### 11.2 开发指南

1. **前端开发指南**：
   - API调用方式
   - 错误处理方式
   - 状态管理方式

2. **后端开发指南**：
   - 接口实现规范
   - 错误返回规范
   - 性能优化建议

### 11.3 测试资料

1. **测试用例**：
   - 接口测试用例
   - 端到端测试用例
   - 边界条件测试用例

2. **测试数据**：
   - 测试用户账号
   - 示例数据源配置
   - 示例查询配置

## 12. 总结

前后端联调是确保系统功能顺利实现的关键阶段。通过本文档的详细规划，我们为DataScope系统的数据源管理和查询构建器模块提供了清晰的联调路径。遵循本文档的接口约定、测试策略和协作流程，将有助于提高开发效率，减少沟通成本，确保系统的高质量交付。